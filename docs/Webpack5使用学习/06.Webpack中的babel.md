---
title: Webpackä¸­çš„babel
date: 2022-05-08 09:24:21
permalink: /pages/f3d33b/
categories:
  - Webpack5ä½¿ç”¨å­¦ä¹ 
tags:
  - 
---
# Webpackä¸­çš„babel

å…³äºBabelçš„å…¥é—¨ï¼Œå¯çœ‹è¿™ç¯‡æ–‡ç« [Babel å…¥é—¨æ•™ç¨‹](https://www.ruanyifeng.com/blog/2016/01/babel.html)

## ä¸ºä»€ä¹ˆéœ€è¦babel

äº‹å®ä¸Šï¼Œåœ¨å¼€å‘ä¸­æˆ‘ä»¬å¾ˆå°‘ç›´æ¥å»æ¥è§¦babelï¼Œä½†æ˜¯babelå¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œç›®å‰æ˜¯ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ï¼š

* å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ES6+çš„è¯­æ³•ï¼Œæƒ³è¦ä½¿ç”¨TypeScriptï¼Œå¼€å‘Reacté¡¹ç›®ï¼Œå®ƒä»¬éƒ½æ˜¯ç¦»ä¸å¼€Babelçš„ï¼›
* å­¦ä¹ Babelå¯¹äºæˆ‘ä»¬ç†è§£ä»£ç ä»ç¼–å†™åˆ°çº¿ä¸Šçš„è½¬å˜è¿‡ç¨‹è‡³å…³é‡è¦ï¼›

Babelæ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œé‡‡ç”¨çš„æ˜¯å¾®å†…æ ¸æ¶æ„ï¼Œä¸»è¦ç”¨äºæ—§æµè§ˆå™¨æˆ–è€…ç¼“è§£ä¸­å°†ECMAScript 2015+ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹ç‰ˆæœ¬çš„JavaScriptä»£ç ã€‚

è¿™æ„å‘³ç€ï¼Œä½ å¯ä»¥ç”¨ ES6 çš„æ–¹å¼ç¼–å†™ç¨‹åºï¼Œåˆä¸ç”¨æ‹…å¿ƒç°æœ‰ç¯å¢ƒæ˜¯å¦æ”¯æŒã€‚

åŒ…æ‹¬ï¼šè¯­æ³•è½¬æ¢ã€æºä»£ç è½¬æ¢ã€Polyfillå®ç°ç›®æ ‡ç¼“è§£ç¼ºå°‘çš„åŠŸèƒ½ç­‰ï¼›

```js
// è½¬ç å‰
input.map(item => item + 1);

// è½¬ç å
input.map(function (item) {
  return item + 1;
});
```

## Babelå‘½ä»¤è¡Œä½¿ç”¨

babelæœ¬èº«å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·ï¼ˆå’Œpostcssä¸€æ ·ï¼‰ï¼Œå¯ä»¥ä¸å’Œwebpackç­‰æ„å»ºå·¥å…·é…ç½®æ¥å•ç‹¬ä½¿ç”¨ã€‚

å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å‘½ä»¤è¡Œå°è¯•ä½¿ç”¨babelï¼Œéœ€è¦å®‰è£…å¦‚ä¸‹åº“ï¼š

* `@babel/core`ï¼šbabelçš„æ ¸å¿ƒä»£ç ï¼Œå¿…é¡»å®‰è£…ï¼›
* `@babel/cli`ï¼šå¯ä»¥è®©æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä½¿ç”¨babelï¼›

è¿™é‡Œæˆ‘ä»¬åœ¨`src/main.js`ä¸­å®ç°å¦‚ä¸‹ä»£ç ï¼š

```js
const message = 'hello world'

const foo = (info) => {
  console.log(info)
}

foo(message)
```

åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š

```shell
npx babel src --out-dir dist
```

ä½¿ç”¨babelæ¥å¤„ç†æˆ‘ä»¬çš„æºä»£ç ï¼š

* srcï¼šæ˜¯æºæ–‡ä»¶çš„ç›®å½•ï¼›
* --out-dirï¼šæŒ‡å®šè¦è¾“å‡ºçš„æ–‡ä»¶å¤¹distï¼›

ç„¶åæŸ¥çœ‹`dist/main.js`æ–‡ä»¶å¦‚ä¸‹ï¼š

```js
const message = 'hello world';

const foo = info => {
  console.log(info);
};

foo(message);
```

å¯ä»¥çœ‹åˆ°ï¼ŒbabelåŸºæœ¬æ²¡æœ‰è¿›è¡Œä»»ä½•è½¬æ¢ï¼Œåªæ˜¯å»æ‰äº†ç®­å¤´å‡½æ•°infoå‚æ•°çš„æ‹¬å·ã€‚

å› ä¸ºè¿™é‡Œå€¼ä½¿ç”¨äº†babelçš„å†…æ ¸ä»£ç `@babel/core`ï¼Œè‡³äº`main.js`ä»£ç è¦å¦‚ä½•è½¬åŒ–ï¼Œå®ƒæ˜¯ä¸çŸ¥é“çš„ï¼Œæ‰€ä»¥ä¸ºäº†è®©ä»£ç è½¬æ¢æˆæˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ï¼Œå°±éœ€è¦ç»™babelè®¾ç½®ç›¸å…³çš„æ’ä»¶ã€‚

æ¯”å¦‚è¦è½¬æ¢ç®­å¤´å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°è½¬æ¢ç›¸å…³çš„æ’ä»¶ï¼š

```shell
npm install @babel/plugin-transform-arrow-functions -D
```

ç„¶åå‘½ä»¤è¡Œä¸­ä½¿ç”¨æ­¤æ’ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š

```shell
npx babel src --out-dir dist --plugins=@babel/plugin-transform-arrow-functions
```

å†æŸ¥çœ‹è¾“å‡ºç»“æœï¼š

```js
const message = 'hello world';

const foo = function (info) {
  console.log(info);
};

foo(message);
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç®­å¤´å‡½æ•°å·²ç»è½¬æ¢æˆäº†æ™®é€šçš„åŒ¿åå‡½æ•°ã€‚

æ¯”å¦‚è¦è½¬æ¢constä¸ºvarï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`@babel/plugin-transform-block-scoping` æ¥å®Œæˆè¿™æ ·çš„åŠŸèƒ½ï¼š

```shell
npm install @babel/plugin-transform-block-scoping -D
```

ç„¶åå‘½ä»¤è¡Œä¸­ä½¿ç”¨æ­¤æ’ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š

```shell
npx babel src --out-dir dist --plugins=@babel/plugin-transform-arrow-functions
```

æŸ¥çœ‹è¾“å‡ºç»“æœå¯ä»¥å‘ç°ï¼Œconstå·²ç»è½¬æ¢æˆäº†varï¼š

```js
var message = 'hello world';

var foo = function (info) {
  console.log(info);
};

foo(message);
```

## Babelçš„é¢„è®¾preset

æˆ‘ä»¬åœ¨è½¬æ¢ç®­å¤´å‡½æ•°å’Œconstä¸­ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªæ’ä»¶ï¼Œå¦‚æœè¦è½¬æ¢çš„å†…å®¹åŒ…å«è®¸å¤šä¸ªES6ç‰¹æ€§è¯­æ³•ï¼Œä¸€ä¸ªä¸ªè®¾ç½®æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨**é¢„è®¾preset**

å®‰è£…@babel/preset-envé¢„è®¾ï¼š

```shell
npm install @babel/preset-env -D
```

è¿™ä¸ªåŒ…æ˜¯ä¸€ç³»åˆ—æ’ä»¶çš„ç»„åˆï¼Œä½¿ç”¨æ­¤åŒ…ä¼šè‡ªåŠ¨æŸ¥æ‰¾éœ€è¦çš„æ’ä»¶æ¥å®Œæˆä»£ç çš„è½¬åŒ–ã€‚å®ç°åŸç†è¯¦è§[æ­¤å¤„]()

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```shell
npx babel src --out-dir dist --presets=@babel/preset-env
```

å¯ä»¥çœ‹åˆ°è½¬æ¢ç»“æœå¦‚ä¸‹ï¼š

```js
"use strict";

var message = 'hello world';

var foo = function foo(info) {
  console.log(info);
};

foo(message);
```

## Babelçš„åº•å±‚åŸç†

ç¼–è¯‘å™¨çš„å·¥ä½œæ˜¯å°†ä¸€ç§æºä»£ç ï¼ˆåŸç”Ÿè¯­è¨€ï¼‰è½¬æ¢æˆå¦ä¸€ç§æºä»£ç ï¼ˆç›®æ ‡è¯­è¨€ï¼‰ã€‚

Bableå…¶å®å°±æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œåªæ˜¯å°†JSä»£ç ä»ä¸€ç§æ ¼å¼è½¬æ¢æˆäº†å¦ä¸€ç§JSä»£ç æ ¼å¼ã€‚

Babelç¼–è¯‘å™¨çš„ä½œç”¨å°±æ˜¯å°†æˆ‘ä»¬çš„æºä»£ç ï¼Œè½¬æ¢æˆæµè§ˆå™¨å¯ä»¥ç›´æ¥è¯†åˆ«çš„å¦å¤–ä¸€æ®µæºä»£ç ï¼›

Babelç¼–è¯‘å™¨çš„å·¥ä½œæµç¨‹æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š

* è§£æé˜¶æ®µï¼ˆParsingï¼‰
* è½¬æ¢é˜¶æ®µï¼ˆTransformationï¼‰
* ç”Ÿæˆé˜¶æ®µï¼ˆCode Generationï¼‰

![webpackä¸­çš„babel01](https://cdn.jsdelivr.net/gh/ccbeango/blogImages@master/Webpack5/webpackä¸­çš„babel01.png)

å½“ç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ç¼–è¯‘å™¨å·¥å…·æµç¨‹ï¼Œåœ¨æ¯ä¸ªé˜¶æ®µåˆä¼šæœ‰è‡ªå·±å…·ä½“çš„å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š

![webpackä¸­çš„babel02](https://cdn.jsdelivr.net/gh/ccbeango/blogImages@master/Webpack5/webpackä¸­çš„babel02.png)

å¯ä»¥ç»“åˆä»£ç çœ‹ä¸‹å…·ä½“çš„æ‰§è¡Œæµç¨‹ï¼š

1. æˆ‘ä»¬æœ‰å¦‚ä¸‹**åŸç”Ÿæºä»£ç **ï¼š

   ```js
   const name = "ccbean";
   const foo = (name) => console.log(name);
   foo(name);
   ```

2. è¿›è¡Œ**è¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰**ï¼Œå®ƒä¼šè¯»å–æ•´ä¸ªæºä»£ç æ–‡ä»¶ï¼Œå°†æ•´ä¸ªæºä»£ç è¯»å–æˆå­—ç¬¦ä¸²ï¼Œä»£ç ä¸­æ¯ä¸ªå†…å®¹éƒ½ä¼šè¢«æå–å‡ºæ¥ï¼Œå¦‚ç¬¬ä¸€è¡Œæœ‰5ä¸ªéƒ¨åˆ†ï¼Œé‚£ä¹ˆå°±ä¼šæå–`const`ã€`name`ã€`=`ã€`"ccbean"`ã€`;`å…±5ä¸ªéƒ¨åˆ†ã€‚

3. è¯æ³•åˆ†ææå–çš„æ¯ä¸ªéƒ¨åˆ†ä¼šç”Ÿæˆ**tokensæ•°ç»„**ï¼Œå¦‚ä¸‹å°±æ˜¯æˆ‘ä»¬çš„ä»£ç åœ¨åˆ†æåå¾—åˆ°çš„tokensæ•°ç»„ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­åŒ…å«äº†ä¸€ä¸ªä¸ª`{type, value}`å…ƒç´ ï¼Œè¿™äº›å°±æ˜¯è¯æ³•åˆ†ææ—¶æå–çš„ä¸€ä¸ªä¸ªè¯æ³•ã€‚

   * typeæ ‡è¯†äº†æ¯ä¸ªè¯çš„ç±»å‹ï¼Œå¦‚å…³é”®å­—`Keyword`ã€æ ‡è¯†ç¬¦`Identifier`ã€æ ‡ç‚¹ç¬¦å·`Punctuator`ã€å­—ç¬¦ä¸²`String`ã€‚
   * valueæ ‡è¯†äº†æ‰€æœ‰è¯çš„å¯¹åº”å€¼ã€‚

   ```js
   [
     {
         "type": "Keyword",
         "value": "const"
     },
     {
         "type": "Identifier",
         "value": "foo"
     },
     {
         "type": "Punctuator",
         "value": "="
     },
     {
         "type": "Punctuator",
         "value": "("
     },
     {
         "type": "Identifier",
         "value": "name"
     },
     {
         "type": "Punctuator",
         "value": ")"
     },
     {
         "type": "Punctuator",
         "value": "=>"
     },
     {
         "type": "Identifier",
         "value": "console"
     },
     {
         "type": "Punctuator",
         "value": "."
     },
     {
         "type": "Identifier",
         "value": "log"
     },
     {
         "type": "Punctuator",
         "value": "("
     },
     {
         "type": "Identifier",
         "value": "name"
     },
     {
         "type": "Punctuator",
         "value": ")"
     },
     {
         "type": "Punctuator",
         "value": ";"
     },
     {
         "type": "Identifier",
         "value": "foo"
     },
     {
         "type": "Punctuator",
         "value": "("
     },
     {
         "type": "String",
         "value": "\"ccbean\""
     },
     {
         "type": "Punctuator",
         "value": ")"
     },
     {
         "type": "Punctuator",
         "value": ";"
     }
   ]
   ```

4. æ ¹æ®tokensæ•°ç»„ä¸­çš„è¯æ³•ï¼Œè¿›è¡Œ**è¯­æ³•åˆ†æï¼ˆsyntatic analysisï¼‰**ï¼Œä¹Ÿç§°ä¸º**Parsing**ï¼Œé‚£ä¹ˆä¼šç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ã€‚

   ```json
   {
     "type": "Program",
     "body": [
       {
         "type": "VariableDeclaration",
         "declarations": [
           {
             "type": "VariableDeclarator",
             "id": {
               "type": "Identifier",
               "name": "foo"
             },
             "init": {
               "type": "ArrowFunctionExpression",
               "id": null,
               "params": [
                 {
                   "type": "Identifier",
                   "name": "name"
                 }
               ],
               "body": {
                 "type": "CallExpression",
                 "callee": {
                   "type": "MemberExpression",
                   "computed": false,
                   "object": {
                     "type": "Identifier",
                     "name": "console"
                   },
                   "property": {
                     "type": "Identifier",
                     "name": "log"
                   }
                 },
                 "arguments": [
                   {
                     "type": "Identifier",
                     "name": "name"
                   }
                 ]
               },
               "generator": false,
               "expression": true,
               "async": false
             }
           }
         ],
         "kind": "const"
       },
       {
         "type": "ExpressionStatement",
         "expression": {
           "type": "CallExpression",
           "callee": {
             "type": "Identifier",
             "name": "foo"
           },
           "arguments": [
             {
               "type": "Literal",
               "value": "ccbean",
               "raw": "\"ccbean\""
             }
           ]
         }
       }
     ],
     "sourceType": "script"
   }
   ```

5. å¯¹æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œ**éå†ï¼ˆTraversalï¼‰**ï¼Œ**è®¿é—®ï¼ˆVisitorï¼‰**æ ‘ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªè®¿é—®è¿‡ç¨‹ä¸­ï¼Œå‡å¦‚æƒ³è¦å°†`const`å…³é”®å­—è½¬æ¢æˆä¸º`var`å…³é”®å­—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨è®¿é—®çš„è¿‡ç¨‹ä¸­**åº”ç”¨æ’ä»¶ï¼ˆPluginï¼‰**ï¼Œå¯¹èŠ‚ç‚¹ä¸­çš„ä»£ç è¿›è¡Œä¿®æ”¹ã€‚åœ¨æ•´ä¸ªéå†è¿‡ç¨‹ä¸­ï¼Œå½“æœ‰èŠ‚ç‚¹éœ€è¦è¿›è¡Œè½¬æ¢æ—¶ï¼Œå°±åº”ç”¨å¯¹åº”çš„æ’ä»¶è¿›è¡Œä»£ç ä¿®æ”¹ã€‚

6. å½“éå†å®Œæ•´é¢—æ ‘ä¹‹åï¼Œå°±ä¼šç”Ÿæˆä¸€é¢—**æ–°çš„æŠ½è±¡è¯­æ³•æ ‘**ã€‚

   ```json
   {
     "type": "Program",
     "body": [
       {
         "type": "VariableDeclaration",
         "declarations": [
           {
             "type": "VariableDeclarator",
             "id": {
               "type": "Identifier",
               "name": "foo"
             },
             "init": {
               "type": "FunctionExpression",
               "id": {
                 "type": "Identifier",
                 "name": "foo"
               },
               "params": [
                 {
                   "type": "Identifier",
                   "name": "name"
                 }
               ],
               "body": {
                 "type": "BlockStatement",
                 "body": [
                   {
                     "type": "ReturnStatement",
                     "argument": {
                       "type": "CallExpression",
                       "callee": {
                         "type": "MemberExpression",
                         "computed": false,
                         "object": {
                           "type": "Identifier",
                           "name": "console"
                         },
                         "property": {
                           "type": "Identifier",
                           "name": "log"
                         }
                       },
                       "arguments": [
                         {
                           "type": "Identifier",
                           "name": "name"
                         }
                       ]
                     }
                   }
                 ]
               },
               "generator": false,
               "expression": false,
               "async": false
             }
           }
         ],
         "kind": "var"
       },
       {
         "type": "ExpressionStatement",
         "expression": {
           "type": "CallExpression",
           "callee": {
             "type": "Identifier",
             "name": "foo"
           },
           "arguments": [
             {
               "type": "Literal",
               "value": "ccbean",
               "raw": "\"ccbean\""
             }
           ]
         }
       }
     ],
     "sourceType": "script"
   }
   ```

7. æ ¹æ®æ–°çš„ASTå†ç”Ÿæˆæœ€ç»ˆçš„è½¬æ¢ä»£ç ã€‚

   ```js
   "use strict";
   
   var name = "ccbean";
   
   var foo = function foo(name) {
     return console.log(name);
   };
   
   foo(name);
   ```

è¿™å°±æ˜¯babelçš„æ•´ä¸ªæ‰§è¡Œæµç¨‹å³è¿è¡ŒåŸç†ã€‚æ‰€ä»¥ï¼Œæ— è®ºæ˜¯è¦è½¬æ¢ä»€ä¹ˆæ ·çš„ä»£ç ï¼Œå¦‚TypeScriptä»£ç ã€ES6ä»£ç ã€JSXä»£ç ï¼Œåªéœ€è¦**åœ¨åˆé€‚çš„ä½ç½®åº”ç”¨å¯¹åº”çš„æ’ä»¶**ï¼Œå°†ä»£ç è½¬æˆä¸€ä¸ªæ–°çš„ASTï¼Œå†æ ¹æ®æ–°ASTè¿›è¡Œè¾“å‡ºï¼Œå°±ä¼šå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„è½¬æ¢æ•ˆæœäº†ã€‚

å…³äºç¼–è¯‘å™¨ï¼Œå¯æŸ¥çœ‹[the-super-tiny-compiler](https://github.com/jamiebuilds/the-super-tiny-compiler)æ¥å­¦ä¹ æ›´å¤šï¼Œè¿™æ˜¯ä¸€ä¸ªä½¿ç”¨JSæ¥å®ç°çš„ç¼–è¯‘å™¨ã€‚

## Webpackä¸­ä½¿ç”¨babel

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨æ„å»ºå·¥å…·ä¸­é€šè¿‡é…ç½®babelæ¥å¯¹å…¶è¿›è¡Œä½¿ç”¨çš„ï¼Œæ¯”å¦‚åœ¨webpackä¸­ã€‚

åœ¨Webpackä¸­ä½¿ç”¨babelï¼Œéœ€è¦å®‰è£…ç›¸åº”çš„loaderï¼Œå³babel-loaderã€‚

```shell
npm install babel-loader -D
```

æˆ‘ä»¬è¿˜éœ€è¦ç”¨åˆ°`@babel/core`å’Œé¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„babelæ’ä»¶æˆ–é¢„è®¾ï¼Œè¿™é‡Œåšæµ‹è¯•å®‰è£…å¦‚ä¸‹åº“ï¼š

```shell
npm install @babel/core @babel/plugin-transform-arrow-functions @babel/plugin-transform-block-scoping @babel/preset-env -D
```

æˆ‘ä»¬é…ç½®è§„åˆ™æ¥ä½¿ç”¨Babelï¼š

```json
module: {
  rules: [
    {
      test: /\.js$/,
      use: {
        loader: 'babel-loader'
      }
    }
  ]
},
```

æ‰§è¡Œ`npm run build`ï¼Œå¯çœ‹åˆ°ç»“æœå¦‚ä¸‹ï¼š

```js
// bundle.js
(function () {
  var __webpack_exports__ = {};

  const name = 'ccbean';

  const foo = name => {
    console.log(name);
  };

  foo(name);
})();
```

### ä½¿ç”¨babelæ’ä»¶

è¿™é‡Œå¹¶æ²¡æœ‰è½¬æ¢ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®æ’ä»¶ï¼Œè¿™é‡Œé…ç½®äº†ä¸¤ä¸ªæ’ä»¶ï¼š

```json
module: {
  rules: [
    {
      test: /\.js$/,
      use: {
        loader: 'babel-loader',
        options: {
          plugins: [
            '@babel/plugin-transform-arrow-functions',
            '@babel/plugin-transform-block-scoping'
          ]
        }
      }
    }
  ]
},
```

æ‰§è¡Œ`npm run build`ï¼Œå¯çœ‹åˆ°ç»“æœå¦‚ä¸‹ï¼Œè½¬æ¢äº†ç®­å¤´å‡½æ•°å’Œå…³é”®å­—`const`ï¼š

```js
(function () {
  var __webpack_exports__ = {};

  var name = 'ccbean';

  var foo = function (name) {
    console.log(name);
  };

  foo(name);
})();
```

### ä½¿ç”¨babelé¢„è®¾

å¦‚æœæˆ‘ä»¬ä¸€ä¸ªä¸ªå»å®‰è£…ä½¿ç”¨æ’ä»¶ï¼Œé‚£ä¹ˆéœ€è¦æ‰‹åŠ¨æ¥ç®¡ç†å¤§é‡çš„babelæ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»™webpackæä¾›ä¸€ä¸ªpresetï¼Œwebpackä¼šæ ¹æ®æˆ‘ä»¬çš„é¢„è®¾æ¥åŠ è½½å¯¹åº”çš„æ’ä»¶åˆ—è¡¨ï¼Œå¹¶ä¸”å°†å…¶ä¼ é€’ç»™babelã€‚

[Babelçš„é¢„è®¾](https://babel.dev/docs/en/babel-preset-env)æœ‰å››ä¸ªï¼š

* envï¼š`@babel/preset-env`
* reactï¼š`@babel/preset-react`
* typescriptï¼š`@babel/preset-typescript`
* flowï¼š`@babel/preset-flow`

å¼€å‘ä¸­å¯ä»¥æ ¹æ®éœ€æ±‚è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªé¢„è®¾ã€‚

è¿™é‡Œæˆ‘ä»¬åšæµ‹è¯•ï¼Œåªå®‰è£…preset-envï¼š

```shell
npm install @babel/preset-env -D
```

ç„¶åè¿›è¡Œé…ç½®ï¼š

```json
{
  test: /\.js$/,
  use: {
    loader: 'babel-loader',
    options: {
      presets: [
        '@babel/preset-env'
      ]
    }
  }
}
```

æ‰§è¡Œ`npm run build`ï¼Œå¯çœ‹åˆ°ç»“æœå¦‚ä¸‹ï¼š

```js
(function () {
  var __webpack_exports__ = {};
  var name = 'ccbean';

  var foo = function foo(name) {
    console.log(name);
  };

  foo(name);
})();
```

### è®¾ç½®ç›®æ ‡æµè§ˆå™¨

æˆ‘ä»¬æœ€ç»ˆæ‰“åŒ…çš„JavaScriptä»£ç ï¼Œæ˜¯éœ€è¦è·‘åœ¨ç›®æ ‡æµè§ˆå™¨ä¸Šçš„ï¼Œé‚£ä¹ˆå¦‚ä½•å‘ŠçŸ¥babelæˆ‘ä»¬çš„ç›®æ ‡æµè§ˆå™¨å‘¢ï¼Ÿ

æœ‰ä¸¤ç§æ–¹æ³•ï¼š

* browserslistå·¥å…·
* targetså±æ€§

**ä½¿ç”¨browserslist**

ä½¿ç”¨é¢„è®¾ï¼ŒBabelåœ¨è¿›è¡Œä»£ç è½¬æ¢æ—¶ï¼Œé»˜è®¤ä¼šæ ¹æ®ç›®æ ‡æµè§ˆå™¨çš„éœ€è¦è¿›è¡Œä»£ç è½¬æ¢ã€‚é»˜è®¤ä¼šè¯»å–`browserslist`é…ç½®æ¥è·å–éœ€è¦é€‚é…çš„æµè§ˆå™¨ï¼Œç„¶åå†æ ¹æ®é€‚é…è¦æ±‚è¿›è¡Œä»£ç è½¬æ¢ã€‚

`.browserslistrc`é…ç½®å¦‚ä¸‹

```js
last 2 version
```

æ‰§è¡Œ`npm run build`ï¼Œå¯çœ‹åˆ°ç»“æœå¦‚ä¸‹ï¼š

```js
(function () {
  var __webpack_exports__ = {};
  var message = 'hello world';

  var foo = function foo(info) {
    console.log(info);
  };

  foo(message);
})();
```

ä¿®æ”¹`.browserslistrc`å¦‚ä¸‹ï¼š

```js
chrome88
```

æ‰§è¡Œ`npm run build`ï¼Œå¯çœ‹åˆ°ç»“æœå¦‚ä¸‹ï¼š

```js
(() => {
  var __webpack_exports__ = {};
  const message = 'hello world';

  const foo = info => {
    console.log(info);
  };

  foo(message);
})();
```

**ä½¿ç”¨targetså±æ€§**

æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡targetsæ¥è¿›è¡Œé…ç½®ç›®æ ‡æµè§ˆå™¨

```json
module: {
  rules: [
    {
      test: /\.js$/,
      use: {
        loader: 'babel-loader',
        options: {
          presets: [
            ['@babel/preset-env', {
              // æ•°ç»„æ ¼å¼ï¼Œç¬¬äºŒä¸ªå…ƒç´ è®¾ç½®options
              targets: "last 2 version"
            }]
          ]
        }
      }
    }
  ]
}
```

æ‰§è¡Œ`npm run build`ï¼Œå¯çœ‹åˆ°ç»“æœå¦‚ä¸‹ï¼š

```js
(function () {
  var __webpack_exports__ = {};
  var message = 'hello world';

  var foo = function foo(info) {
    console.log(info);
  };

  foo(message);
})();
```

**å¦‚æœä¸¤ä¸ªåŒæ—¶é…ç½®äº†ï¼Œ`targets`å±æ€§çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œä¼šè¦†ç›–browserslistã€‚ä½†æ˜¯åœ¨å¼€å‘ä¸­ï¼Œæ›´æ¨èé€šè¿‡browserslistæ¥é…ç½®ï¼›ç±»ä¼¼çš„postcsså·¥å…·ï¼Œä¹Ÿä¼šä½¿ç”¨browserslistã€‚æ–¹ä¾¿è¿›è¡Œç»Ÿä¸€æµè§ˆå™¨çš„é€‚é…ã€‚**

### Babelçš„Stage-Xè®¾ç½®

åœ¨babel7ä¹‹å‰ï¼ˆæ¯”å¦‚babel6ä¸­ï¼‰ï¼Œæˆ‘ä»¬ä¼šç»å¸¸çœ‹åˆ°è¿™ç§è®¾ç½®æ–¹å¼ï¼š

```js
module.exports = {
  "presets": ["stage-0"]
}
```

ä¸Šé¢çš„é…ç½®è¡¨è¾¾çš„å«ä¹‰æ˜¯ä½¿ç”¨å¯¹åº”çš„`babel-preset-stage-x `é¢„è®¾ï¼Œé€šå¸¸åœ¨æ—§çš„é¡¹ç›®ä¸­ä¼šçœ‹åˆ°ç±»ä¼¼çš„é…ç½®ï¼›**ä»babel7å¼€å§‹**ï¼Œå·²ç»ä¸å»ºè®®ä½¿ç”¨äº†ï¼Œå»ºè®®ä½¿ç”¨preset-envæ¥è®¾ç½®ã€‚

ä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯è¦äº†è§£ä¸‹Stage-Xæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œè¦äº†è§£Stage-Xï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹TC39çš„ç»„ç»‡ï¼š

* TC39æ˜¯æŒ‡æŠ€æœ¯å§”å‘˜ä¼šï¼ˆTechnical Committeeï¼‰ç¬¬ 39 å·ï¼›
* å®ƒæ˜¯ ECMA çš„ä¸€éƒ¨åˆ†ï¼ŒECMA æ˜¯ â€œECMAScriptâ€ è§„èŒƒä¸‹çš„ JavaScript è¯­è¨€æ ‡å‡†åŒ–çš„æœºæ„ï¼›
* ECMAScript è§„èŒƒå®šä¹‰äº† JavaScript å¦‚ä½•ä¸€æ­¥ä¸€æ­¥çš„è¿›åŒ–ã€å‘å±•ï¼›

TC39 éµå¾ªçš„åŸåˆ™æ˜¯ï¼šåˆ†é˜¶æ®µåŠ å…¥ä¸åŒçš„è¯­è¨€ç‰¹æ€§ï¼Œæ–°æµç¨‹æ¶‰åŠå››ä¸ªä¸åŒçš„ Stageï¼š

* **Stage 0**ï¼šstrawmanï¼ˆç¨»è‰äººï¼‰ï¼Œä»»ä½•å°šæœªæäº¤ä½œä¸ºæ­£å¼ææ¡ˆçš„è®¨è®ºã€æƒ³æ³•å˜æ›´æˆ–è€…è¡¥å……éƒ½è¢«è®¤ä¸ºæ˜¯ç¬¬ 0 é˜¶æ®µçš„"ç¨»è‰äºº"ï¼›
* **Stage 1**ï¼šproposalï¼ˆæè®®ï¼‰ï¼Œææ¡ˆå·²ç»è¢«æ­£å¼åŒ–ï¼Œå¹¶æœŸæœ›è§£å†³æ­¤é—®é¢˜ï¼Œè¿˜éœ€è¦è§‚å¯Ÿä¸å…¶ä»–ææ¡ˆçš„ç›¸äº’å½±å“ï¼›
* **Stage 2**ï¼šdraftï¼ˆè‰ç¨¿ï¼‰ï¼ŒStage 2çš„ææ¡ˆåº”æä¾›è§„èŒƒåˆç¨¿ã€è‰ç¨¿ã€‚æ­¤æ—¶ï¼Œè¯­è¨€çš„å®ç°è€…å¼€å§‹è§‚å¯Ÿ runtime çš„å…·ä½“å®ç°æ˜¯å¦åˆç†ï¼›
* **Stage 3**ï¼šcandidateï¼ˆå€™è¡¥ï¼‰ï¼ŒStage 3ææ¡ˆæ˜¯å»ºè®®çš„å€™é€‰ææ¡ˆã€‚åœ¨è¿™ä¸ªé«˜çº§é˜¶æ®µï¼Œè§„èŒƒçš„ç¼–è¾‘äººå‘˜å’Œè¯„å®¡äººå‘˜å¿…é¡»åœ¨æœ€ç»ˆè§„èŒƒä¸Šç­¾å­—ã€‚Stage 3 çš„ææ¡ˆä¸ä¼šæœ‰å¤ªå¤§çš„æ”¹å˜ï¼Œåœ¨å¯¹å¤–å‘å¸ƒä¹‹å‰åªæ˜¯ä¿®æ­£ä¸€äº›é—®é¢˜ï¼›
* Stage 4ï¼šfinishedï¼ˆå®Œæˆï¼‰ï¼Œè¿›å…¥Stage 4çš„ææ¡ˆå°†åŒ…å«åœ¨ ECMAScript çš„ä¸‹ä¸€ä¸ªä¿®è®¢ç‰ˆä¸­ï¼›

### Babelçš„é…ç½®æ–‡ä»¶

babelçš„é…ç½®ä¿¡æ¯å¯ä»¥æ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œä¸€æ˜¯ç®€åŒ–webpackä¸­Ruleçš„loaderç¼–å†™ï¼ŒäºŒæ˜¯å¤šä¸ªåœ°éƒ½éœ€è¦ä½¿ç”¨babelï¼Œé‚£ä¹ˆbabelé…ç½®å¯ä»¥å¤ç”¨ã€‚

babelç»™æˆ‘ä»¬æä¾›äº†ä¸¤ç§é…ç½®æ–‡ä»¶çš„ç¼–å†™ï¼š

* `babel.config.json`ï¼ˆæˆ–è€…`.js`ã€`.cjs`ã€`.mjs`ï¼‰æ–‡ä»¶ï¼›
* `.babelrc.json`ï¼ˆæˆ–è€…`.babelrc`ã€`.js`ã€`.cjs`ã€`.mjs`ï¼‰æ–‡ä»¶ï¼›

å®ƒä»¬ä¸¤ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿç›®å‰å¾ˆå¤šçš„é¡¹ç›®éƒ½é‡‡ç”¨äº†å¤šåŒ…ç®¡ç†çš„æ–¹å¼ï¼ˆbabelæœ¬èº«ã€element-plusã€umiç­‰ï¼‰ï¼›

* `.babelrc.json`ï¼šæ—©æœŸä½¿ç”¨è¾ƒå¤šçš„é…ç½®æ–¹å¼ï¼Œä½†æ˜¯å¯¹äºé…ç½®Monoreposé¡¹ç›®æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼› 
* `babel.config.json`ï¼ˆbabel7ï¼‰ï¼šå¯ä»¥ç›´æ¥ä½œç”¨äºMonoreposé¡¹ç›®çš„å­åŒ…ï¼Œæ›´åŠ æ¨èï¼›

æ³¨ï¼šMonoreposæ˜¯ç®¡ç†é¡¹ç›®çš„ä¸€ç§æ–¹å¼å³ä¸€ä¸ªé¡¹ç›®ä¸­åˆ†å¤šä¸ªåŒ…ï¼Œå¯¹åº”çš„æ˜¯Multireposå³å¤šä»“åº“ã€‚

æˆ‘ä»¬ä½¿ç”¨`babel.config.js`ä½œä¸ºbabelçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š

```js
module.exports = {
  plugins: [
    // '@babel/plugin-transform-arrow-functions',
    // '@babel/plugin-transform-block-scoping'
  ],
  presets: [
    '@babel/preset-env',
    // ['@babel/preset-env', {
    //   targets: "last 2 version"
    // }],
  ],
}
```

åœ¨`webpack.config.js`ä¸­ä¿®æ”¹é…ç½®ï¼š

```json
module: {
  rules: [
    {
      test: /\.js$/,
      loader: 'babel-loader'
    }
  ]
}
```

`.browserslistrc`ä¸­é…ç½®

```js
> 1%
last 2 version
not dead
```

å†æ‰§è¡Œæ„å»ºå¯çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š

```js
(function () {
  var __webpack_exports__ = {};
  var message = 'hello world';

  var foo = function foo(info) {
    console.log(info);
  };

  foo(message);
})();
```

å¯ä»¥ä¿®æ”¹ç›¸å…³é…ç½®å†è¿›è¡Œæ„å»ºï¼Œæµ‹è¯•é…ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚

## polyfill

### è®¤è¯†polyfill

ä»€ä¹ˆæ˜¯polyfillï¼Ÿå¯ä»¥ç†è§£æˆå¡«å……ç‰©ã€å«ç‰‡ã€è¡¥ä¸ï¼Œæ˜¯ä¸ºäº†å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ä½¿ç”¨JavaScriptã€‚

ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨polyfillï¼Ÿ

Babelé»˜è®¤åªè½¬æ¢æ–°çš„JavaScriptå¥æ³•ï¼ˆsyntaxï¼‰ï¼Œè€Œä¸è½¬æ¢æ–°çš„APIï¼Œæ¯”å¦‚Iteratorã€Generatorã€Setã€Mapsã€Proxyã€Reflectã€Symbolã€Promiseç­‰å…¨å±€å¯¹è±¡ï¼Œä»¥åŠä¸€äº›å®šä¹‰åœ¨å…¨å±€å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼ˆæ¯”å¦‚`Object.assign`ã€`Array.prototype.from`ï¼‰éƒ½ä¸ä¼šè½¬ç ï¼Œç›®æ ‡æµè§ˆå™¨ä¸­æ²¡æœ‰è¿™ä¸ªæ–°APIæ—¶ï¼Œå°±ä¼šæŠ¥é”™ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œå½“ä½¿ç”¨Promiseè¿™ä¸ªè¯­æ³•ç‰¹æ€§æ—¶ï¼Œç›®æ ‡æµè§ˆå™¨ä¸­å¯èƒ½æ²¡æœ‰è¿™ä¸ªç‰¹æ€§ï¼Œå°±ä¼šæŠ¥é”™ã€‚é‚£ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨polyfillæ¥å¢åŠ ä¸€ä¸ªå«ç‰‡æˆ–è€…è¯´æ‰“ä¸€ä¸ªè¡¥ä¸ï¼Œå°†è¯¥ç‰¹æ€§åŒ…å«åˆ°æ‰“åŒ…ä»£ç ä¸­ï¼Œä¿è¯ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œã€‚

åœ¨`main.js`ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š

```js
const message = 'hello world'

const foo = (info) => {
  console.log(info)
}

foo(message)

const p = new Promise((resolve, reject) => {})
```

è¿è¡Œ`npm run build`è¿›è¡Œæ‰“åŒ…

```js
(function () {
  var __webpack_exports__ = {};
  var message = 'hello world';

  var foo = function foo(info) {
    console.log(info);
  };

  foo(message);
  var p = new Promise(function (resolve, reject) { });
})();
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„ä»£ç è¢«è½¬æˆäº†ES5é£æ ¼ï¼Œä½†æ˜¯å´åŒ…å«äº†ES6ä¸­æ‰å‡ºç°çš„Promsie APIï¼Œæœ‰äº›æµè§ˆå™¨ä¸æ”¯æŒå®ƒï¼Œè¿è¡Œå°±ä¼šæŠ¥é”™ã€‚

è¿™æ—¶ï¼Œä½¿ç”¨polyfillæä¾›Promise APIçš„å«ç‰‡ã€‚

### ä½¿ç”¨polyfill

babel7.4.0ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨[@babel/polyfill](https://babeljs.io/docs/en/babel-polyfill)çš„åŒ…ï¼Œä½†æ˜¯è¯¥åŒ…ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œå®‰è£…æ—¶ä¼šæœ‰è­¦å‘Šï¼š

```js
> npm i @babel/polyfill 
// è­¦å‘Š
npm WARN deprecated @babel/polyfill@7.12.1: ğŸš¨ This package has been deprecated in favor of separate inclusion of a polyfill and regenerator-runtime (when needed). See the @babel/polyfill docs (https://babeljs.io/docs/en/babel-polyfill) for more information.
npm WARN deprecated core-js@2.6.12: core-js@<3.4 is no longer maintained and not recommended for usage due to the number of issues. Because of the V8 engine whims, feature detection in old core-js versions could cause a slowdown up to 100x even if nothing is polyfilled. Please, upgrade your dependencies to the actual version of core-js.
```

`@babel/polyfill`åŒ…å«äº†å®šåˆ¶çš„[regenerator runtime](https://github.com/facebook/regenerator/blob/master/packages/runtime/runtime.js) and [core-js](https://github.com/zloirock/core-js)

babel7.4.0ä¹‹åï¼Œä¸æ¨èç›´æ¥ä½¿ç”¨`@babel/polyfill`ï¼Œå¯ä»¥é€šè¿‡å•ç‹¬å¼•å…¥`core-js`å’Œ`regenerator-runtime`æ¥å®Œæˆ`polyfill`çš„ä½¿ç”¨

```js
npm install core-js regenerator-runtime --save
```

ç„¶åï¼Œæˆ‘ä»¬éœ€è¦åœ¨babel.config.jsæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œç»™é¢„è®¾é…ç½®ä¸€äº›å±æ€§ã€‚

* `useBuiltIns`ï¼šè®¾ç½®ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ¥ä½¿ç”¨polyfillï¼Œå…±æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼š

  * `false` é»˜è®¤å€¼ã€‚æ‰“åŒ…åçš„æ–‡ä»¶ä¸ä½¿ç”¨polyfillæ¥è¿›è¡Œé€‚é…ã€‚å¹¶ä¸”è¿™æ—¶æ˜¯ä¸éœ€è¦è®¾ç½®corejså±æ€§çš„

  * `usage` æ ¹æ®æºä»£ç ä¸­å‡ºç°çš„è¯­è¨€ç‰¹æ€§ï¼Œè‡ªåŠ¨æ£€æµ‹ä»£ç ä¸­æ‰€éœ€è¦çš„polyfillï¼Œåªå¯¼å…¥ç”¨åˆ°çš„APIã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æœ€ç»ˆåŒ…é‡Œçš„polyfillæ•°é‡çš„æœ€å°åŒ–ï¼Œæ‰“åŒ…çš„åŒ…ç›¸å¯¹ä¼šå°ä¸€äº›

  * `entry` å¯¼å…¥æ‰€æœ‰çš„polyfillï¼Œæ— è®ºæºä»£ç ä¸­æ˜¯å¦æœ‰ç”¨åˆ°ç›¸åº”çš„è¯­è¨€ç‰¹æ€§ã€‚è¿™æ ·ä¼šæ ¹æ® `browserslist`ç›®æ ‡å¯¼å…¥æ‰€æœ‰çš„polyfillï¼Œå¯¹åº”çš„åŒ…ä¼šæ›´å¤§ã€‚

    * åº”ç”¨åœºæ™¯ï¼šå¦‚æœæˆ‘ä»¬ä¾èµ–çš„æŸä¸€ä¸ªåº“æœ¬èº«ä½¿ç”¨äº†æŸäº›polyfillçš„ç‰¹æ€§ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯usageï¼Œæ‰€ä»¥ä¹‹åç”¨æˆ·æµè§ˆå™¨å¯èƒ½ä¼šæŠ¥é”™ï¼›

    * ä½¿ç”¨æ–¹å¼ï¼šå…¥å£æ–‡ä»¶ä¸­éœ€è¦å¯¼å…¥è¦åº”ç”¨çš„corejså’Œruntime

      ```js
      import 'core-js/stable';
      import 'regenerator-runtime/runtime';
      ```

* `corejs`ï¼šè®¾ç½®corejsçš„ç‰ˆæœ¬ï¼Œé»˜è®¤ç‰ˆæœ¬æ˜¯`2.0`ï¼Œç›®å‰ä½¿ç”¨è¾ƒå¤šçš„æ˜¯3.xçš„ç‰ˆæœ¬ï¼›å¯ä»¥è‡ªè¡ŒæŒ‡å®šã€‚è¿™ä¸ªé€‰é¡¹åªæœ‰åœ¨å’Œ`useBuiltIns`åŒæ—¶ä½¿ç”¨æ—¶æ‰èµ·ä½œç”¨ã€‚

  * å¦å¤–corejså¯ä»¥è®¾ç½®æ˜¯å¦å¯¹æè®®é˜¶æ®µçš„ç‰¹æ€§è¿›è¡Œæ”¯æŒï¼Œè®¾ç½® proposalså±æ€§ä¸ºtrueå³å¯ã€‚

**è®¾ç½®`useBuiltIns: 'usage'`**

ä»£ç ä¸­éœ€è¦ç”¨åˆ°çš„polyfillæ‰å¼•å…¥ã€‚

`babel.config.js`è®¾ç½®å¦‚ä¸‹ï¼š

```js
module.exports = {
  presets: [
    ['@babel/preset-env', {
      useBuiltIns: false,
    }]
  ]
}
```

æ­¤å¤–ï¼Œæˆ‘ä»¬é€šå¸¸è¦åœ¨è§„åˆ™ä¸­é…ç½®`exclude`æ’é™¤å¯¹node_modulesç›®å½•ä¸­åº”ç”¨polyfillï¼š

```json
{
  test: /\.js$/,
  loader: 'babel-loader',
  exclude: /node_modules/
}
```

`npm run build`æ‰§è¡Œæ„å»ºåå¯ä»¥çœ‹åˆ°æ‰“åŒ…æ–‡ä»¶ä¼šå¤šå‡ºæ¥å¾ˆå¤špolyfillæ³¨å…¥çš„ä»£ç ã€‚

**è®¾ç½®`useBuiltIns: 'entry'`**

å¯¼å…¥æ‰€æœ‰çš„pofillï¼Œæ— è®ºä»£ç ä¸­æ˜¯å¦ç”¨åˆ°ã€‚

`babel.config.js`è®¾ç½®å¦‚ä¸‹ï¼š

```js
module.exports = {
  presets: [
    ['@babel/preset-env', {
      useBuiltIns: 'entry', // false usage entry
      corejs: 3
    }]
  ]
}
```

å…¥å£æ–‡ä»¶`main.js`æ‰‹åŠ¨å¼•å…¥ï¼š

```js
import 'core-js/stable'
import 'regenerator-runtime/runtime'

// ...

const p = new Promise((resolve, reject) => {})
```

`npm run build`æ‰§è¡Œæ„å»ºåå¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„æ–‡ä»¶æ›´å¤§ã€‚

### è®¤è¯†plugin-transform-runtime

åœ¨å‰é¢æˆ‘ä»¬ä½¿ç”¨çš„polyfillï¼Œé»˜è®¤æƒ…å†µæ˜¯æ·»åŠ çš„æ‰€æœ‰ç‰¹æ€§éƒ½æ˜¯å…¨å±€çš„ã€‚

è¿™ä¸ªæ’ä»¶æœ‰ä¸¤ä¸ªä½œç”¨ï¼š

* é¿å…å¤šå‡ºä½¿ç”¨çš„ç›¸åŒçš„å‡½æ•°è¢«é‡å¤ç¼–è¯‘è¾“å‡ºã€‚
* é¿å…polyfillå…¨å±€æ±¡æŸ“ã€‚å¦‚æœæˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªå·¥å…·åº“ï¼Œè¿™ä¸ªå·¥å…·åº“éœ€è¦ä½¿ç”¨polyfillï¼›åˆ«äººåœ¨ä½¿ç”¨æˆ‘ä»¬å·¥å…·æ—¶ï¼Œå·¥å…·åº“é€šè¿‡polyfillæ·»åŠ çš„ç‰¹æ€§ï¼Œå¯èƒ½ä¼šæ±¡æŸ“ä»–çš„ä»£ç ï¼›

æ‰€ä»¥ï¼Œå½“ç¼–å†™å·¥å…·æ—¶ï¼Œbabelæ›´æ¨èæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ’ä»¶ï¼š [@babel/plugin-transform-runtime](https://babeljs.io/docs/en/babel-plugin-transform-runtime)æ¥å®Œæˆpolyfillçš„åŠŸèƒ½ï¼›

### ä½¿ç”¨plugin-transform-runtime

å®‰è£… @babel/plugin-transform-runtimeï¼š

```js
npm install @babel/plugin-transform-runtime -D
```

ä½¿ç”¨pluginsæ¥é…ç½®babel.config.jsï¼š

```js
module.exports = {
  presets: [
    '@babel/preset-env',
  ],
  plugins: [
    ['@babel/plugin-transform-runtime', {
      corejs: 3
    }]
  ]
}
```

ä½¿ç”¨è¿™ä¸ªæ’ä»¶æ—¶ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†ä½¿ç”¨`@babel/preset-env`ä¸­çš„`useBuiltIns`å±æ€§ã€‚

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨corejsçš„ç‰ˆæœ¬æ˜¯3ï¼Œè¿˜éœ€è¦å®‰è£…å¯¹åº”çš„[runtime helpers](https://babeljs.io/docs/en/babel-plugin-transform-runtime#corejs)

```js
npm install @babel/runtime-corejs3 -D
```

`npm run build`æ‰§è¡Œæ„å»ºåå¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ç”Ÿæˆç»“æœã€‚

## babelè½¬æ¢å„ç±»JS

### Reactçš„JSXç¼–è¯‘

åœ¨æˆ‘ä»¬ç¼–å†™reactä»£ç æ—¶ï¼Œreactä½¿ç”¨çš„è¯­æ³•æ˜¯jsxï¼Œjsxæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨babelæ¥è½¬æ¢çš„ã€‚

å¯¹react jsxä»£ç è¿›è¡Œå¤„ç†éœ€è¦å¦‚ä¸‹çš„æ’ä»¶ï¼š

* @babel/plugin-syntax-jsx
* @babel/plugin-transform-react-jsx
* @babel/plugin-transform-react-display-name

ä½†æ˜¯å¼€å‘ä¸­ï¼Œå¹¶ä¸éœ€è¦ä¸€ä¸ªä¸ªå»å®‰è£…è¿™äº›æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„é¢„è®¾[babel-preset-react]( https://babeljs.io/docs/en/babel-preset-react)æ¥é…ç½®ï¼š

```js
npm install @babel/preset-react -D
```

ç„¶åé…ç½®åº”ç”¨æ­¤é¢„è®¾ï¼š

```js
module.exports = {
  presets: [
    ['@babel/preset-env'],
    ['@babel/preset-react'],
  ]
}
```

è¦ä½¿ç”¨reactï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å®‰è£…reactå¼€å‘ç›¸å…³ä¾èµ–ï¼š

```shell
npm i react react-dom -D
```

ç¼–å†™`react_index.js`æ–‡ä»¶ï¼Œå¹¶é…ç½®å…¶ä¸ºå…¥å£æ–‡ä»¶ï¼š

```react
import React from 'react'
import ReactDOM from 'react-dom'

class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      message: 'Hello React'
    }
  }

  render() {
    return (
      <h2>{this.state.message}</h2>
    )
  }
}

ReactDOM.render(<App/>, document.getElementById('app'))
```

æµè§ˆå™¨ä¸­æ‰“å¼€`build/index.html`å¯ä»¥çœ‹åˆ°Hello Reactè¢«æ¸²æŸ“äº†å‡ºæ¥ã€‚

### TypeScriptçš„ç¼–è¯‘

åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨TypeScriptæ¥å¼€å‘ï¼Œé‚£ä¹ˆTypeScriptä»£ç æ˜¯éœ€è¦è½¬æ¢æˆJavaScriptä»£ç ã€‚

å¯ä»¥é€šè¿‡TypeScriptçš„compileræ¥è½¬æ¢æˆJavaScriptï¼š

```shell
npm install typescript -D
```

TypeScriptçš„ç¼–è¯‘é…ç½®ä¿¡æ¯æˆ‘ä»¬é€šå¸¸ä¼šç¼–å†™ä¸€ä¸ª`tsconfig.json`æ–‡ä»¶ã€‚é‚£ä¹ˆå…ˆè¿›è¡Œåˆå§‹åŒ–ï¼š

```shell
npx tsc --init
```

ä¹‹åæˆ‘ä»¬å¯ä»¥è¿è¡Œ`npx tsc`æ¥ç¼–è¯‘è‡ªå·±çš„TSä»£ç 

```shell
npx tsc
```

å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶`ts_main.ts`ï¼š

```typescript
const message: string = "Hello TypeScript";

const foo = (info: string) => {
  console.log(info);
}

foo(message);

export {}
```

æ‰§è¡Œç¼–è¯‘`npx tsc`ï¼Œç”Ÿæˆæ–‡ä»¶å¦‚ä¸‹ï¼š

```js
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const message = "Hello TypeScript";
const foo = (info) => {
    console.log(info);
};
foo(message);
```

å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨webpackä¸­ä½¿ç”¨TypeScriptï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ts-loaderæ¥å¤„ç†tsæ–‡ä»¶ï¼š

```shell
npm install ts-loader -D
```

ç„¶åé…ç½®Webpackçš„Ruleï¼š

```json
{ // ç¼–è¯‘ts
  test: /\.ts$/,
  use: [
    'ts-loader'
  ]
}
```

ç„¶åæ‰§è¡Œ`npm run build`å°±å¯ä»¥ä½¿ç”¨Webpackç¼–è¯‘TSä»£ç äº†ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨äº†ES6+æ–°APIï¼Œts-loaderå¹¶ä¸ä¼šå¯¹ä»£ç è¿›è¡Œpolyfillã€‚

å‡å¦‚æˆ‘ä»¬ä»£ç ä¸­ä½¿ç”¨äº†Promiseï¼š

```typescript
const message: string = "Hello TypeScript";

const foo = (info: string) => {
  console.log(info);
}

foo(message);

const p = new Promise((resolve, reject) => {})

export {}
```

ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰è½¬æ¢Promsieï¼Œåœ¨ä¸æ˜¯Promiseçš„æµè§ˆå™¨ä¸Šå°±ä¼šå‡ºç°æŠ¥é”™ï¼š

```js
(function () {
  "use strict";
  var __webpack_exports__ = {};
  !function () {
    var exports = __webpack_exports__;
    Object.defineProperty(exports, "__esModule", ({ value: true }));
    const message = "Hello TypeScript";
    const foo = (info) => {
      console.log(info);
    };
    foo(message);
    const p = new Promise((resolve, reject) => { });

  }();
})();
```

å¦‚æœæƒ³è¦å¢åŠ Polyfillï¼Œå¯ä»¥ä½¿ç”¨Babelæä¾›çš„é¢„è®¾[@babel/preset-typescript](https://babeljs.io/docs/en/babel-preset-typescript)

å®‰è£…é¢„è®¾ï¼š

```shell
npm install @babel/preset-typescript -D
```

é…ç½®`babel.config.js`

```js
module.exports = {
  presets: [
    ['@babel/preset-env', {
      useBuiltIns: 'usage',
      corejs: 3
    }],
    ["@babel/preset-typescript"]
  ]
}
```

é…ç½®Webpackçš„Ruleï¼š

```json
{ 
  test: /\.ts$/,
  use: [
    'babel-loader'
  ]
}
```

å†è¿›è¡Œbuildæ„å»ºï¼Œå¯ä»¥çœ‹åˆ°ä»£ç æœ‰polyfillçš„å¤„ç†ã€‚

ä¸è¿‡ï¼Œè¿™ç§æ–¹æ¡ˆä¹Ÿæœ‰ä¸€ä¸ªç¼ºé™·ï¼Œbabel-loaderåªä¼šå¯¹TSä»£ç è¿›è¡Œè½¬åŒ–ï¼Œå¹¶ä¸ä¼šå¯¹TSä»£ç è¿›è¡ŒéªŒè¯ã€‚

æ¥çœ‹ä¸‹é¢çš„ä¾‹å­

```typescript
const foo = (info: string) => {
  console.log(info);
}

foo(123);
```

å‡½æ•°`foo()`è¦æ±‚ä¼ å…¥å‚æ•°å¿…é¡»æ˜¯stringç±»å‹ï¼Œä½†æ˜¯è¿™é‡Œä¼ å…¥äº†numberç±»å‹ï¼Œæ‰§è¡Œç¼–è¯‘ï¼Œå¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰æŠ¥é”™ï¼š

```shell
$ npm run build
> webpack

asset index.html 323 bytes [emitted]
asset bundle.js 269 bytes [emitted] (name: main) 1 related asset
./src/main.ts 65 bytes [built] [code generated]
webpack 5.72.0 compiled successfully in 1678 ms
```

ä½¿ç”¨ts-loaderå¯ä»¥çœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼š

```shell
npm run build

> webpack

[tsl] ERROR in D:\Code\Webpack\hello-webpack\09_webpackä¸­babelè½¬æ¢å„ç±»JS\src\main.ts(5,5)
      TS2345: Argument of type 'number' is not assignable to parameter of type 'string'.
ts-loader-default_e3b0c44298fc1c14
```

æ€»ç»“å¦‚ä¸‹ï¼š

* ä½¿ç”¨ts-loaderï¼ˆTypeScript Compilerï¼‰ï¼Œæ¥ç›´æ¥ç¼–è¯‘TypeScriptï¼Œé‚£ä¹ˆåªèƒ½å°†tsè½¬æ¢æˆjs
  * å¦‚æœæˆ‘ä»¬è¿˜å¸Œæœ›åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ·»åŠ å¯¹åº”çš„polyfillï¼Œé‚£ä¹ˆts-loaderæ˜¯æ— èƒ½ä¸ºåŠ›çš„ï¼›
  * éœ€è¦å€ŸåŠ©äºbabelæ¥å®Œæˆpolyfillçš„å¡«å……åŠŸèƒ½ï¼›
* ä½¿ç”¨babel-loaderï¼ˆBabelï¼‰æ¥ç›´æ¥ç¼–è¯‘TypeScript
  * ä¹Ÿå¯ä»¥å°†tsè½¬æ¢æˆjsï¼Œå¹¶ä¸”å¯ä»¥å®ç°polyfillçš„åŠŸèƒ½ï¼›
  * ä½†æ˜¯babel-loaderåœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šå¯¹ç±»å‹é”™è¯¯è¿›è¡Œæ£€æµ‹ï¼›

é‚£ä¹ˆåœ¨å¼€å‘ä¸­ï¼Œå¦‚ä½•å¯ä»¥åŒæ—¶ä¿è¯ä¸¤ä¸ªæƒ…å†µéƒ½æ²¡æœ‰é—®é¢˜å‘¢ï¼Ÿ

TypeScriptå®˜ç½‘ç»™å‡ºäº†[å»ºè®®](https://www.typescriptlang.org/docs/handbook/babel-with-typescript.html#babel-vs-tsc-for-typescript)

> When making a modern JavaScript project, you might ask yourself what is the right way to convert files from TypeScript to JavaScript?
>
> A lot of the time the answer is *â€œit dependsâ€*, or *â€œsomeone may have decided for youâ€* depending on the project. If you are building your project with an existing framework like [tsdx](https://tsdx.io/), [Angular](https://angular.io/), [NestJS](https://nestjs.com/) or any framework mentioned in the [Getting Started](https://www.typescriptlang.org/docs/home) then this decision is handled for you.
>
> However, a useful heuristic could be:
>
> - Is your build output mostly the same as your source input files? Use `tsc`
> - Do you need a build pipeline with multiple potential outputs? Use `babel` for transpiling and `tsc` for type checking

ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨Babelæ¥å®Œæˆä»£ç çš„è½¬æ¢ï¼Œä½¿ç”¨tscæ¥è¿›è¡Œç±»å‹çš„æ£€æŸ¥ã€‚

åœ¨`package.json`ä¸­æ·»åŠ è„šæœ¬

```json
"scripts": {
  "build": "webpack",
  "build2": "npm run check & webpack",
  "check": "tsc --noEmit" // --noEmit å¿½ç•¥è¾“å‡º
},
```

ç„¶åæ‰§è¡Œ`npm run build2`ï¼Œå¯ä»¥å®ç°ä¸Šè¿°éœ€æ±‚ï¼Œåœ¨tscç±»å‹æ ¡éªŒä¹‹åï¼Œå†è¿›è¡Œæ„å»ºã€‚

### Vueçš„ç¼–è¯‘

åœ¨Webpackä¸­ç¼–è¯‘Vueï¼Œé¦–å…ˆå®‰è£…ç›¸å…³ä¾èµ–ï¼š

```shell
npm i vue vue-loader vue-template-compiler -D
```

åœ¨Webpackä¸­é…ç½®Ruleï¼š

```json
{
  test: /\.vue$/,
  use: "vue-loader",
},
{
  test: /\.less$/,
  use: [
    'style-loader',
    {
      loader: 'css-loader',
      options: {
        importLoaders: 2
      }
    },
    'postcss-loader',
    'less-loader'
  ]
}
```

åŒæ—¶éœ€è¦åœ¨pluginä¸­å¼•å…¥VueLoaderçš„æ’ä»¶ï¼š

```js
const { VueLoaderPlugin } = require("vue-loader");

plugins: [
  // other
  // ...
  new VueLoaderPlugin(),
],
```

Vueæ–‡ä»¶å¦‚ä¸‹

App.vue

```vue
<template>
  <div id="app">
    <h2 class="title">{{message}}</h2>
  </div>
</template>

<script>
export default {
  data() {
    return {
      message: "Hello Vue"
    }
  }
}
</script>

<style scoped lang="less">
  .title {
    color: red
  }
</style>
```

vue_main.js

```js
import { createApp } from 'vue'
import App from "./App.vue";

createApp(App).mount('#app')
```

ç¼–è¯‘åæµè§ˆå™¨å¯ä»¥çœ‹åˆ°ç¼–è¯‘æˆåŠŸçš„çº¢è‰²Hello Vueã€‚

## ESLint

### è®¤è¯†ESLint

[ESLint](https://eslint.org/)æ˜¯ä¸€ä¸ªé™æ€ä»£ç åˆ†æå·¥å…·ï¼ˆStatic program analysisï¼Œåœ¨æ²¡æœ‰ä»»ä½•ç¨‹åºæ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œå¯¹ä»£ç è¿›è¡Œåˆ†æï¼‰ï¼›

ESLintå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å»ºç«‹ç»Ÿä¸€çš„å›¢é˜Ÿä»£ç è§„èŒƒï¼Œä¿æŒæ­£ç¡®ã€ç»Ÿä¸€çš„ä»£ç é£æ ¼ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ï¼›å¹¶ä¸”ESLintçš„è§„åˆ™æ˜¯å¯é…ç½®çš„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å±äºè‡ªå·±çš„è§„åˆ™ã€‚

æ—©æœŸè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å·¥å…·ï¼Œæ¯”å¦‚JSLintã€JSHintã€JSCSç­‰ï¼Œç›®å‰ä½¿ç”¨æœ€å¤šçš„æ˜¯ESLintã€‚

### ä½¿ç”¨ESLint

é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…ESLintï¼š

```shell
npm install eslint -D
```

ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤åˆ›å»ºESLintçš„é…ç½®æ–‡ä»¶ï¼š

```shell
npx eslint --init
```

æ ¹æ®å‘½ä»¤è¡Œæç¤ºå¯ä»¥ç”Ÿæˆ`.eslintrc.js`é…ç½®æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬æ·»åŠ è§„åˆ™ï¼š

```js
module.exports = {
  "env": {
    "browser": true,
    "commonjs": true,
    "es2021": true
  },
  "parserOptions": {
    "ecmaVersion": 12
  },
  "rules": {
    'no-unused-vars': 'error',
    quotes: ['warn', 'single'],
    'no-console': 0,
    'import/no-extraneous-dependencies': 0,
  }
};

```

JSæ–‡ä»¶`main.js`å¦‚ä¸‹ï¼š

```js
const message = "Hello World";

const foo = (info) => {
  console.log(info);
}

foo('abc')
```

æ‰§è¡Œæ£€æµ‹ï¼Œå¯ä»¥çœ‹åˆ°æŠ¥é”™ï¼š

```shell
$ npx eslint .\src\main.js

D:\Code\Webpack\hello-webpack\10_webpackä¸­eslintçš„ä½¿ç”¨\src\main.js
  1:7   error  'message' is assigned a value but never used  no-unused-vars
  1:17  error  Strings must use singlequote                  quotes

âœ– 2 problems (2 errors, 0 warnings)
  1 error and 0 warnings potentially fixable with the `--fix` option.
```

### ESLintçš„æ–‡ä»¶è§£æ

åœ¨å‘½ä»¤è¡Œä¸­é€‰æ‹©reactæ”¯æŒï¼Œç”Ÿæˆå¦‚ä¸‹é…ç½®ï¼š

```js
module.exports = {
    "env": {
        "browser": true,
        "commonjs": true,
        "es2021": true
    },
    "extends": [
        "eslint:recommended",
        "plugin:react/recommended",
        "plugin:@typescript-eslint/recommended"
    ],
    "parser": "@typescript-eslint/parser",
    "parserOptions": {
        "ecmaFeatures": {
            "jsx": true
        },
        "ecmaVersion": 12
    },
    "plugins": [
        "react",
        "@typescript-eslint"
    ],
    "rules": {
    }
};
```

å­—æ®µå«ä¹‰ï¼š

* envï¼šè¿è¡Œçš„ç¯å¢ƒï¼Œæ¯”å¦‚æ˜¯æµè§ˆå™¨ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¼šä½¿ç”¨es2021ï¼ˆå¯¹åº”çš„`ecmaVersion`æ˜¯12ï¼‰çš„è¯­æ³•ï¼›
* extendsï¼šå¯ä»¥æ‰©å±•å½“å‰çš„é…ç½®ï¼Œè®©å…¶ç»§æ‰¿è‡ªå…¶ä»–çš„é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼ˆå¤šä¸ªï¼‰ï¼›
* parserOptionsï¼šè¿™é‡Œå¯ä»¥æŒ‡å®šESMAScriptçš„ç‰ˆæœ¬ã€sourceTypeçš„ç±»å‹
  * parserï¼šé»˜è®¤æƒ…å†µä¸‹æ˜¯`espree`ï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªJS Parserï¼Œç”¨äºESLintï¼‰ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦ç¼–è¯‘TypeScriptï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå¯¹åº”çš„è§£é‡Šå™¨ï¼›
* pluginsï¼šæŒ‡å®šç”¨åˆ°çš„æ’ä»¶ï¼›
* rulesï¼šè‡ªå®šä¹‰çš„ä¸€äº›è§„åˆ™ï¼›
  * æ ¼å¼æ˜¯ï¼š é…ç½®çš„è§„åˆ™åç§°ï¼šå¯¹åº”çš„å€¼å€¼å¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²ã€æ•°ç»„ã€‚
    * å­—ç¬¦ä¸²å¯¹åº”æœ‰ä¸‰ä¸ªå€¼ï¼š `off`ã€`warn`ã€`error`ï¼›
    * æ•°å­—å¯¹åº”æœ‰ä¸‰ä¸ªå€¼ï¼š `0`ã€`1`ã€`2`ï¼ˆåˆ†åˆ«å¯¹åº”ä¸Šé¢çš„å€¼ï¼‰ï¼›
    * æ•°ç»„æˆ‘ä»¬å¯ä»¥å‘ŠçŸ¥å¯¹åº”çš„æç¤ºä»¥åŠå¸Œæœ›è·å–åˆ°çš„å€¼ï¼šæ¯”å¦‚ `['error', 'double']`

### webpackä¸­é…ç½®ESLint

åœ¨ç¼–è¯‘ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›è¿›è¡Œä»£ç çš„eslintæ£€æµ‹ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨eslint-loaderæ¥å®Œæˆ

```shell
npm install eslint-loader -D
```

åœ¨Webpackä¸­é…ç½®Ruleï¼š

```json
{
  test: /\.jsx?$/,
  exclude: /node_modules/,
  use: [
    'babel-loader',
    'eslint-loader'
  ] 
}
```

å†æ‰§è¡Œæ„å»ºï¼Œä¼šå‡ºç°å¦‚ä¸Šç›¸åŒæŠ¥é”™ã€‚

### VSCodeä¸­çš„æ’ä»¶

æˆ‘ä»¬åœ¨å¼€å‘ä¸­é€šå¸¸ä¼šå€ŸåŠ©æ’ä»¶æ¥æ›´å¥½åœ°ä½¿ç”¨ESLintæ¥æ£€æŸ¥ä»£ç ã€‚

[ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)

è¿™ä¸ªæ’ä»¶ä¼šä½¿ç”¨é¡¹ç›®è·å–å…¨å±€å®‰è£…çš„ESLintåº“ï¼Œç„¶åé»˜è®¤è¯»å–é¡¹ç›®ç›®å½•ä¸‹çš„ESLinté…ç½®ï¼Œè¿™é‡Œæ˜¯`.eslintrc.js`æ–‡ä»¶ï¼Œæ ¹æ®æ­¤æ–‡ä»¶é…ç½®è§„åˆ™æ¥æ£€æŸ¥å½“å‰é¡¹ç›®ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒã€‚

[Prettier](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)

ESLintä¼šå¸®åŠ©æˆ‘ä»¬æç¤ºé”™è¯¯ï¼ˆæˆ–è€…è­¦å‘Šï¼‰ï¼Œä½†æ˜¯ä¸ä¼šå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ä¿®å¤ã€‚

è¿™ä¸ªæ’ä»¶å¯ä»¥åœ¨æ–‡ä»¶åœ¨ä¿å­˜æ—¶ï¼Œè‡ªåŠ¨ä¿®å¤ä»£ç ä¸­ä¸ç¬¦åˆè§„èŒƒçš„é—®é¢˜ã€‚

ä¿®æ”¹VSCodeä¸­çš„é…ç½®é€‰é¡¹` "editor.defaultFormatter": "esbenp.prettier-vscode"`ã€‚

![webpackä¸­çš„eslint01](https://cdn.jsdelivr.net/gh/ccbeango/blogImages@master/Webpack5/webpackä¸­çš„eslint01.png)

ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶`.prettierrc`ï¼š

```json
{
  "singleQuote": true,
  "trailingComma": "all",
  "printWidth": 100,
  "proseWrap": "never",
  "arrowParens": "avoid",
  "overrides": [
    {
      "files": ".prettierrc",
      "options": {
        "parser": "json"
      }
    }
  ]
}
```

æ­¤é…ç½®æ¥è‡ªäº[ant-design](https://github.com/ant-design/ant-design/blob/master/.prettierrc)ï¼Œå…³äºæ’ä»¶çš„å…·ä½“é…ç½®å¯ä»¥æŸ¥é˜…[Prettierå®˜ç½‘](https://prettier.io/)ã€‚







