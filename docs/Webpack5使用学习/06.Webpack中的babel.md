---
title: Webpack中的babel
date: 2022-05-08 09:24:21
permalink: /pages/f3d33b/
categories:
  - Webpack5使用学习
tags:
  - 
---
# Webpack中的babel

关于Babel的入门，可看这篇文章[Babel 入门教程](https://www.ruanyifeng.com/blog/2016/01/babel.html)

## 为什么需要babel

事实上，在开发中我们很少直接去接触babel，但是babel对于前端开发来说，目前是不可缺少的一部分：

* 开发中，我们想要使用ES6+的语法，想要使用TypeScript，开发React项目，它们都是离不开Babel的；
* 学习Babel对于我们理解代码从编写到线上的转变过程至关重要；

Babel是一个工具链，采用的是微内核架构，主要用于旧浏览器或者缓解中将ECMAScript 2015+代码转换为向后兼容版本的JavaScript代码。

这意味着，你可以用 ES6 的方式编写程序，又不用担心现有环境是否支持。

包括：语法转换、源代码转换、Polyfill实现目标缓解缺少的功能等；

```js
// 转码前
input.map(item => item + 1);

// 转码后
input.map(function (item) {
  return item + 1;
});
```

## Babel命令行使用

babel本身可以作为一个独立的工具（和postcss一样），可以不和webpack等构建工具配置来单独使用。

如果我们希望在命令行尝试使用babel，需要安装如下库：

* `@babel/core`：babel的核心代码，必须安装；
* `@babel/cli`：可以让我们在命令行使用babel；

这里我们在`src/main.js`中实现如下代码：

```js
const message = 'hello world'

const foo = (info) => {
  console.log(info)
}

foo(message)
```

在命令行中执行：

```shell
npx babel src --out-dir dist
```

使用babel来处理我们的源代码：

* src：是源文件的目录；
* --out-dir：指定要输出的文件夹dist；

然后查看`dist/main.js`文件如下：

```js
const message = 'hello world';

const foo = info => {
  console.log(info);
};

foo(message);
```

可以看到，babel基本没有进行任何转换，只是去掉了箭头函数info参数的括号。

因为这里值使用了babel的内核代码`@babel/core`，至于`main.js`代码要如何转化，它是不知道的，所以为了让代码转换成我们想要的格式，就需要给babel设置相关的插件。

比如要转换箭头函数，那么我们就可以使用箭头函数转换相关的插件：

```shell
npm install @babel/plugin-transform-arrow-functions -D
```

然后命令行中使用此插件，输入如下命令：

```shell
npx babel src --out-dir dist --plugins=@babel/plugin-transform-arrow-functions
```

再查看输出结果：

```js
const message = 'hello world';

const foo = function (info) {
  console.log(info);
};

foo(message);
```

我们可以看到箭头函数已经转换成了普通的匿名函数。

比如要转换const为var，我们需要使用`@babel/plugin-transform-block-scoping` 来完成这样的功能：

```shell
npm install @babel/plugin-transform-block-scoping -D
```

然后命令行中使用此插件，输入如下命令：

```shell
npx babel src --out-dir dist --plugins=@babel/plugin-transform-arrow-functions
```

查看输出结果可以发现，const已经转换成了var：

```js
var message = 'hello world';

var foo = function (info) {
  console.log(info);
};

foo(message);
```

## Babel的预设preset

我们在转换箭头函数和const中，使用了两个插件，如果要转换的内容包含许多个ES6特性语法，一个个设置是比较麻烦的，这时我们可以使用**预设preset**

安装@babel/preset-env预设：

```shell
npm install @babel/preset-env -D
```

这个包是一系列插件的组合，使用此包会自动查找需要的插件来完成代码的转化。实现原理详见[此处]()

执行如下命令：

```shell
npx babel src --out-dir dist --presets=@babel/preset-env
```

可以看到转换结果如下：

```js
"use strict";

var message = 'hello world';

var foo = function foo(info) {
  console.log(info);
};

foo(message);
```

## Babel的底层原理





